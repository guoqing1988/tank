# 科协naive智障履带车和它的爪子源码



1. 履带车介绍：
该车由3部分组成，分别是动力部分，机械臂部分，和控制部分。其中，动力模块由电机控制板和电机以及底盘和履带组成。机械臂部分由机械臂（6个舵机驱动），舵机控制板组成。控制部分由一块Arduino mega开发版，ps2手柄接收器组成。为了保障各模块工作正常，分别用12.6v动力电池，8.4v动力电池，普通2节18650串联8.4v电池组成。
2. 功能实现流程：
该车暂时由ps2手柄完全控制，未来会加入自动控制功能。手柄以2.4ghz频段与控制部分通讯，使用索尼自己开发的协议而不是蓝牙。控制部分接受到手柄发来的数据后进行处理，其中对小车的移动通过滤波后通过6个io口直接控制电机控制板的H桥，控制机械臂的按以下格式通过串口3以9600的波特率发给机械臂控制板：
帧头	数据长度	指令	参数 
0x55 0x55	Length	Cmd	Prm 1...Prm N 
  1.指令名 CMD_ SERVO_MOVE 指令值 3 数据长度 Length: 说明:控制任意个舵机的转动，数据长度 Length =控制舵机的个数×3+5 
  参数 1:要控制舵机的个数 参数 2:时间低八位
  参数 3:时间高八位 
  参数 4:舵机 ID 号
  参数 5:角度位置低八位
  参数 6:角度位置高八位
  参数......:格式与参数 4,5,6 相同，控制不同 ID 的角度位置 

  2.指令名CMD _ACTION_GROUP_RUN 指令值 6 数据长度(Length)值:5 说明:控制动作组运行，前提是该动作组已经下载到控制板。可以控制动作组运 
  行的次数，如果想让该动作组一直运行，则次参数值为 0 代表无限次 
  参数 1:要运行的动作组的编号 参数 2:动作组要运行的次数低八位 参数 3:动作组要运行的次数高八位 
  3. 指令名CMD _ACTION_GROUP_STOP 指令值 7 数据长度(Length)值:2 说明:停止正在运行的动作组。如果动作组没有运行，也发送了次命令则不影响。 参数:无参数 
  4.指令名:CMD_ACTION_GROUP _SPEED Cmd值:11 数据长度(Length)值:5 
  说明:控制动作组的速度，以百分比的形式表示，比如要控制 1 号动作组的速度 是原来的 2 倍，则百分比数值为 200，代表 200% 如果动作组编号为 0xFF，则 代表，调整所有下载的动作组的速度。
  注意: 1，调整的速度参数关机不保存，如果想要调整速度，每次开机都要进行设置。 2，舵机也有自己的极限速度，如果你将速度调快为原来的好几倍，但是已经超 过舵机的最大转动速度，调快也是没有意义的，这点请用户注意 
  参数 1:要调整的动作组的编号 参数 2:速度百分比低八位 参数 3:速度百分比高八位 

  5. 指令名:CMD_GET_BATTERY_VOLTAGE Cmd值:15 数据长度(Length)值:2 
  说明:获取控制板电池电压，单位毫伏，发送此指令后控制板会立刻返回数据， 返回的数据是带有两个参数值的数据包，
  参数 1:无参数 
3. 使用说明：
  同时打开控制部分和遥控器电源，会自动配对。
  配对成功后，打开机械臂和电机控制的电源。
  使用左侧遥感控制小车移动，其他按钮和右侧遥感控制机械臂。
  使用结束后，请先断开机械臂和电机控制的电源。

